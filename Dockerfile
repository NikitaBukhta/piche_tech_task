# WARNING! Dockerfile was generated by ChatGPT and wasn't tested yet;

FROM mcr.microsoft.com/windows/servercore:ltsc2022

RUN powershell -NoProfile -ExecutionPolicy Bypass -Command \
    Set-ExecutionPolicy RemoteSigned -scope CurrentUser; \
    [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; \
    iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

RUN choco install mingw --version=8.1.0 \
    && choco install cmake --installargs 'ADD_CMAKE_TO_PATH=System' \
    && choco install make \
    && choco install git

ENV PATH="C:/ProgramData/chocolatey/bin;C:/Program Files/mingw-w64/x86_64-8.1.0-posix-seh-rt_v6-rev0/mingw64/bin;${PATH}"

WORKDIR /app
COPY . .

RUN git submodule update --init --recursive

RUN ./build.bat 6

CMD ["cmd", "/c", "start", "app\\app_tech_task_solution.exe"]
